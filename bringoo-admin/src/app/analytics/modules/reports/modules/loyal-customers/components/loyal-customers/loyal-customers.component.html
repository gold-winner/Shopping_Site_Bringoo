<div class="mx-8 mt-8 mb-8">
  <div class="d-flex justify-content-between">


    <a class="d-flex align-items-center" routerLink='../'><i nz-icon nzType="left" nzTheme="outline"></i><h3 class='mb-0'>Loyal customers</h3></a>

    <div>
      <button nz-button nzType="text">Print <i nz-icon nzType="printer"></i></button>
      <button nz-button nzType="text">Export <i nz-icon nzType="export"></i></button>
      <button nz-button nzType="primary" nzShape="round">Create order</button>
    </div>
  </div>

  <div class="container-fluid">
    <app-loyal-customers-filter-form (salesFilter)="filterPatch($event)"></app-loyal-customers-filter-form>

    <nz-table
      *ngIf="loyalCustomers$ | async as customers"
      nzShowSizeChanger
      nzShowPagination
      [nzData]="items"
      [nzFrontPagination]="false"
      [nzLoading]="isLoading$|async"
      [nzTotal]="customers.total"
      [nzPageIndex]="customers.page"
      (nzPageIndexChange)="checkedPage = false"
      [nzShowTotal]="rangeTemplate"
      [nzPageSizeOptions]="nzPageSizeOptions"
      (nzQueryParams)="onQueryParamsChange($event)"
      [nzSize]="'small'"
      [nzScroll]="{ x: '250px' }"
    >
      <thead>
      <tr>
        <th nzShowCheckbox [(nzChecked)]="checkedPage" (nzCheckedChange)='onAllChecked($event)' [nzWidth]="'50px'"></th>
        <th [nzSortFn]="true" [nzColumnKey]="'customerNumber'">Customer Number</th>
        <th [nzSortFn]="true" [nzColumnKey]="'customerName'">Name</th>
        <th [nzSortFn]="true" [nzColumnKey]="'totalOrders'" class="text-align-right">Total Orders</th>
        <th [nzSortFn]="true" [nzColumnKey]="'totalStores'" class="text-align-right">Total Stores</th>
        <th [nzSortFn]="true" [nzColumnKey]="'grandTotal'" class="text-align-right">Total Order Value</th>
        <th [nzSortFn]="true" [nzColumnKey]="'lastOrderDate'">Last purchase date</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of customers.items; let index = index">
        <th nzShowCheckbox [nzChecked]="setOfChecked.has(item.customerId)" (nzCheckedChange)="onItemChecked(item.customerId, $event)"></th>
        <td class="text-bold">{{item.customerNumber}}</td>
        <td><a routerLink="/users/customers/details/{{item.customerId}}">{{item.customerName}}</a></td>
        <td class="text-align-right text-bold">{{item.totalOrders}}</td>
        <td class="text-align-right text-bold">{{item.totalStores}}</td>
        <td class="text-align-right text-bold">{{item.grandTotal|formatPrice}}</td>
        <td class="text-bold">{{item.lastOrderDate|date:dateTimeFormat}}</td>
      </tr>
      </tbody>
    </nz-table>

    <ng-template #rangeTemplate let-range="range" let-total>
      {{ range[0] }}-{{ range[1] }} of {{ total }} items
      <div *ngIf='setOfChecked.size'>Selected {{setOfChecked.size}}</div>
    </ng-template>
  </div>
</div>
