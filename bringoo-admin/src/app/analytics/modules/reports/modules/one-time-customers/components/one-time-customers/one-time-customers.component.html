<div class="mx-8 mt-8 mb-8">
  <div class="d-flex justify-content-between">
    <a class="d-flex align-items-center" routerLink='../'><i nz-icon nzType="left" nzTheme="outline"></i><h3 class='mb-0'>One-time Customers</h3></a>
    <div>
      <button nz-button nzType="text">Print <i nz-icon nzType="printer"></i></button>
      <button nz-button nzType="text">Export <i nz-icon nzType="export"></i></button>
      <button nz-button nzType="primary" nzShape="round">Create order</button>
    </div>
  </div>

  <div class="container-fluid">
    <app-one-time-customers-filter-form (salesFilter)="filterPatch($event)"></app-one-time-customers-filter-form>

    <nz-table
      *ngIf="oneTimeCustomers$ | async as customers"
      nzShowSizeChanger
      nzShowPagination
      [nzData]="items"
      [nzFrontPagination]="false"
      [nzLoading]="isLoading$|async"
      [nzTotal]="customers.total"
      [nzPageIndex]="customers.page"
      [nzPageSize]="salesQuery.getValue().limit || 10"
      (nzPageIndexChange)="checkedPage = false"
      [nzShowTotal]="rangeTemplate"
      [nzPageSizeOptions]="nzPageSizeOptions"
      (nzQueryParams)="onQueryParamsChange($event)"
      [nzSize]="'small'"
    >
      <thead>
      <tr>
        <th nzShowCheckbox [(nzChecked)]="checkedPage" (nzCheckedChange)='onAllChecked($event)' [nzWidth]="'50px'"></th>
        <th [nzSortFn]="true" [nzColumnKey]="'customerNumber'">Customer Number</th>
        <th [nzSortFn]="true" [nzColumnKey]="'customerName'">Name</th>
        <th [nzSortFn]="true" [nzColumnKey]="'totalRevenue'" class='text-align-right'>Total Revenue</th>
        <th [nzSortFn]="true" [nzColumnKey]="'itemsPurchased'" class='text-align-right'>Items purchased</th>
        <th [nzSortFn]="true" [nzColumnKey]="'storeName'">Store</th>
        <th [nzSortFn]="true" [nzColumnKey]="'purchaseDate'" nzRight>Purchase Date</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of customers.items; let index = index">
        <th nzShowCheckbox [nzChecked]="setOfChecked.has(item.customerId!)" (nzCheckedChange)="onItemChecked(item.customerId!, $event)"></th>
        <td><a routerLink="/users/customers/details/{{item.customerId}}">{{item.customerNumber}}</a></td>
        <td><a routerLink="/users/customers/details/{{item.customerId}}">{{item.customerName}}</a></td>
        <td class='text-align-right nowrap text-bold'>{{item.totalRevenue|formatPrice}}</td>
        <td class='text-align-right nowrap text-bold'>{{item.itemsPurchased}}</td>
        <td><a routerLink="/store/stores/{{item.storeId}}/basic-information">{{item.storeName}}</a></td>
        <td nzRight class="text-bold">{{item.purchaseDate|date:dateFormat}}</td>
      </tr>
      </tbody>
    </nz-table>

    <ng-template #rangeTemplate let-range="range" let-total>
      {{ range[0] }}-{{ range[1] }} of {{ total }} items
      <div *ngIf='setOfChecked.size'>Selected {{setOfChecked.size}}</div>
    </ng-template>
  </div>
</div>
